<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tp.admin.dao.AdminTerOperatingLogDao">

    <insert id="insert">
        INSERT INTO `admin_ter_operating_log` (
			`ter_id`,
			`employee_id`,
			`username`,
			`title`,
			`intros`,
			`type`,
			`op_source`,
			`sucess`
		) VALUES (
			#{terId},
			#{employeeId},
			#{username},
			#{title},
			#{intros},
			#{type},
			#{opSource},
			#{sucess}
		)
    </insert>

    <select id="listMaintionEmployeeLogBySearch" resultMap="AdminTerOperatingLogDTOMap">
		SELECT
		log.id ,
		log.title ,
		log.create_time ,
		log.ter_id ,
		log.employee_id ,
		emp.name AS employee_username ,
		ti.title AS ter_title,
		log.intros ,
		log.type ,
		log.op_source ,
		log.sucess
		FROM
		`admin_ter_operating_log` AS log
		INNER JOIN `ter_info` AS ti ON log.ter_id = ti.ter_id
		INNER JOIN `admin_maintion_employee` AS emp ON emp.id = log.employee_id
		WHERE
		log.ter_id = #{terId}
		ORDER BY log.create_time DESC
		<if test="pageSize != null and pageSize !=0 and offset != null">
			LIMIT #{offset},#{pageSize}
		</if>
    </select>

    <select id="cntMaintionEmployeeLogBySearch" resultType="java.lang.Integer">
		SELECT
		COUNT(log.id)
		FROM
		admin_ter_operating_log AS log
			INNER JOIN ter_info AS ti ON log.ter_id = ti.ter_id
			INNER JOIN admin_maintion_employee AS emp ON emp.id = log.employee_id
		WHERE
		log.ter_id = #{terId}
    </select>

	<select id="listMerchantEmployeeLogBySearch" resultMap="AdminTerOperatingLogDTOMap">
		SELECT
		log.id ,
		log.title ,
		log.create_time ,
		log.ter_id ,
		log.employee_id ,
		emp.name AS employee_username ,
		ti.title AS ter_title,
		log.intros ,
		log.type ,
		log.op_source ,
		log.sucess
		FROM
		`admin_ter_operating_log` AS log
		INNER JOIN `ter_info` AS ti ON log.ter_id = ti.ter_id
		INNER JOIN `admin_merchant_employee` AS emp ON emp.id = log.employee_id
		WHERE
		log.ter_id = #{terId}
		ORDER BY log.create_time DESC
		<if test="pageSize != null and pageSize !=0 and offset != null">
			LIMIT #{offset},#{pageSize}
		</if>
	</select>

	<select id="cntMerchantEmployeeLogBySearch" resultType="java.lang.Integer">
		SELECT
		COUNT(log.id)
		FROM
		admin_ter_operating_log AS log
			INNER JOIN ter_info AS ti ON log.ter_id = ti.ter_id
			INNER JOIN admin_merchant_employee AS emp ON emp.id = log.employee_id
		WHERE
		log.ter_id = #{terId}
	</select>

	<resultMap id="AdminTerOperatingLogDTOMap"
			   type="com.tp.admin.data.dto.AdminTerOperatingLogDTO">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
		<result column="ter_id" property="terId" jdbcType="INTEGER"/>
		<result column="ter_title" property="terTitle" jdbcType="VARCHAR"/>
		<result column="employee_id" property="employeeId" jdbcType="INTEGER"/>
		<result column="employee_username" property="username" jdbcType="VARCHAR"/>
		<result column="title" property="title" jdbcType="VARCHAR"/>
		<result column="intros" property="intros" jdbcType="VARCHAR"/>
		<result column="type" property="type" jdbcType="INTEGER"/>
		<result column="op_source" property="opSource" jdbcType="INTEGER"/>
		<result column="sucess" property="sucess" jdbcType="BIT"/>
	</resultMap>

</mapper>